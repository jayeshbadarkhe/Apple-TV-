!function(e){"function"==typeof define&&define.amd?define(e):e()}((function(){"use strict";void 0!==typeof self&&self;function getCookie(e="",t=document.cookie){const o=t.match(new RegExp(`(?:^|;\\s*)${e}=([^;]*)`));if(o)return o[1]}function setCookie(e,t,o="",i=14,n,s){const r=new Date;n=null!=n?n:window;const l=(s=null!=s?s:/\./.test(n.location.hostname)?n.location.hostname:"").length>0?`domain=${s}; `:"";r.setTime(r.getTime()+24*i*60*60*1e3);let a="";"https:"===n.location.protocol&&(a="; secure"),n.document.cookie=`${e}=${t}; expires=${r.toUTCString()}; ${l}path=${o}${a}`}function removeCookie(e,t,o){setCookie(e,"","/",0,t,o)}function getLocalStorage(){let e;return function(){let e=!1;try{e="undefined"!=typeof localStorage}catch(t){}return e}()&&(e=localStorage),e}var e="undefined"!=typeof FastBoot?FastBoot.require("buffer").Buffer:"undefined"!=typeof process&&null!==process.versions&&null!==process.versions.node?Buffer:window.Buffer;function memoize(e){return function(...t){let o="",i=t.length;for(e._memoized=e._memoized||{};i--;){const e=t[i];o+=e===Object(e)?JSON.stringify(e):e}return o in e._memoized?e._memoized[o]:e._memoized[o]=e(...t)}}function isNodeEnvironment(e){const isDefined=e=>null!=e;return 0===arguments.length&&"undefined"!=typeof process&&(e=process),isDefined(e)&&isDefined(e.versions)&&isDefined(e.versions.node)||"undefined"!=typeof FastBoot}memoize(isNodeEnvironment()?t=>e.from(t,"base64").toString("binary"):e=>window.atob(e)),memoize(isNodeEnvironment()?t=>e.from(t).toString("base64"):e=>window.btoa(e));const debounce=(e,t=250,o={isImmediate:!1})=>{let i;return function(...n){const s=this,r=o.isImmediate&&void 0===i;void 0!==i&&clearTimeout(i),i=setTimeout((function(){i=void 0,o.isImmediate||e.apply(s,n)}),t),r&&e.apply(s,n)}};const t=["trace","debug","info","warn","error"];class Nonsole{}t.forEach(e=>{Nonsole.prototype[e]=()=>{}});const o=new Nonsole,getConsole=()=>"undefined"==typeof console?o:console,i={},createLocalStorageFlag=e=>{const t=getLocalStorage(),o=e.toLowerCase().replace(/[^a-zA-Z0-9]+(.)/g,(e,t)=>t.toUpperCase());let n;return i.hasOwnProperty(o)?n=i[o]:(n={get:()=>null==t?void 0:t.getItem(e),json:()=>{const o=null==t?void 0:t.getItem(e);try{return o?JSON.parse(o):void 0}catch(i){return}},setJson:o=>{try{const i=JSON.stringify(o);null==t||t.setItem(e,i)}catch(i){}},remove:()=>null==t?void 0:t.removeItem(e),set:o=>null==t?void 0:t.setItem(e,o)},i[o]=n),n};createLocalStorageFlag("mk-debug"),createLocalStorageFlag("mk-debug-topic");const n=getLocalStorage(),getConfiguredLevel=(e="mk-debug",o=t.length)=>parseInt(s(e,o),10),s=memoize((e,t)=>{var o,i;return null!==(i=null===(o=null==n?void 0:n.getItem)||void 0===o?void 0:o.call(n,e))&&void 0!==i?i:""+t}),getAllowedLevels=e=>isNaN(e)||e<0?[]:t.slice(e),canLogTopic=(e,t)=>{const o=((e="mk-debug-topic",t="*")=>s(e,t))(t);return r(o).some(t=>t.test(e))},r=memoize(e=>e.split(/[\s,]+/).map(e=>{const t=e.replace(/\*/g,".*?");return new RegExp("^"+t+"$")})),trace=(e,...t)=>logMessage(Object.assign({level:"trace"},e),...t),debug=(e,...t)=>logMessage(Object.assign({level:"debug"},e),...t),info=(e,...t)=>logMessage(Object.assign({level:"info"},e),...t),warn=(e,...t)=>logMessage(Object.assign({level:"warn"},e),...t),error=(e,...t)=>logMessage(Object.assign({level:"error"},e),...t),log=(e,...t)=>logMessage(e,...t),logMessage=(e,...t)=>{let{level:o,levelKey:i,topic:n,topicKey:s}=e;if(o=null!=o?o:"debug",!((e,t)=>-1!==getAllowedLevels(getConfiguredLevel(t)).indexOf(e))(o,i))return;if(!canLogTopic(n,s))return;const r=getConsole();if("function"!=typeof r[o])return;let[l,...a]=t;void 0!==n&&(l=`${n}: ${l}`),r[o](l,...a)};class Logger{constructor(e){var t,o,i,n;this._levelFilterKey="mk-debug","string"==typeof e?(this._levelFilterKey=e,this.level=getConfiguredLevel(this._levelFilterKey,5)):"object"==typeof e?(this._levelFilterKey=null!==(t=e.levelFilterStorageKey)&&void 0!==t?t:this._levelFilterKey,this._topicFilterKey=null!==(o=e.topicFilterStorageKey)&&void 0!==o?o:this.generateDefaultTopicFilterStorageKey(this._levelFilterKey),this.topic=e.topic,this.level=null!==(i=e.level)&&void 0!==i?i:getConfiguredLevel(this._levelFilterKey,5)):this.level=null!=e?e:getConfiguredLevel(this._levelFilterKey,5),this._topicFilterKey=null!==(n=this._topicFilterKey)&&void 0!==n?n:this.generateDefaultTopicFilterStorageKey(this._levelFilterKey)}get enabled(){return this.level<5}set enabled(e){this.level=e?1:5}debug(e,...t){this.callLogMethod(debug,e,...t)}error(e,...t){this.callLogMethod(error,e,...t)}log(e,...t){this.callLogMethod(log,e,...t)}info(e,...t){this.callLogMethod(info,e,...t)}trace(e,...t){this.callLogMethod(trace,e,...t)}warn(e,...t){this.callLogMethod(warn,e,...t)}callLogMethod(e,t,...o){var i,n;const s={levelKey:this._levelFilterKey,topicKey:this._topicFilterKey,topic:this.topic};let r=t;var l;"object"==typeof(l=t)&&null!==l&&"string"==typeof l.topic&&(s.topic=null!==(i=t.topic)&&void 0!==i?i:s.topic,r=null!==(n=t.message)&&void 0!==n?n:o.shift()),e(s,r,...o)}generateDefaultTopicFilterStorageKey(e){return e+"-topic"}}new Logger;const l=new Logger("sk-debug");var a;!function(e){e.DEFAULT_CID="pldfltcid",e.TV_CID="pltvcid",e.RESTRICTIONS_ENABLED="itre",e.STOREFRONT_COUNTRY_CODE="itua",e.USER_TOKEN="media-user-token"}(a||(a={}));const d=Object.keys(a).map(e=>a[e]);function isFrameCookie(e){return-1!==d.indexOf(e)}function setFrameCookie(e,t){l.debug("auth-bridge: setFrameCookie",e,t),isFrameCookie(e)?(t=null!=t?t:"")?setCookie(e,t,"/",7):removeCookie(e):l.debug("auth-bridge: setFrameCookie ignoring",e)}(new class extends class{constructor(){this._targetOrigin="*"}init(e,t){var o;this._receiveWindow=e,this._sendWindow=t,this.handleMessage=this.handleMessage.bind(this),null===(o=this._receiveWindow)||void 0===o||o.addEventListener("message",this.handleMessage)}sendMessage(e,t){const o={action:"mediakit:"+e,data:t};this._sendWindow&&this._sendWindow.postMessage(JSON.stringify(o),this._targetOrigin)}handleMessage(e){if(!this._isOriginAllowed(e.origin))return;let t;try{t=JSON.parse(e.data)}catch(i){}if(!t||!this._isNamespacedData(t))return;"*"===this._targetOrigin&&(this._targetOrigin=e.origin),l.debug("auth-bridge: handleMessage",t);const o=t.action.replace("mediakit:","");this[o]?this[o](t.data):l.debug("auth-bridge: unsupported method",o)}_isOriginAllowed(e){if(!e)return!1;const[t,o]=e.split("://");let i="";return o&&(i=o.split(":")[0]),"https"===t&&!!i&&i.endsWith(".apple.com")}_isNamespacedData(e){return e.action&&-1!==e.action.indexOf("mediakit:")}}{constructor(e){var t,o;super(),this._cookieNames=[...d],this._enabled=!0,e&&(t=e,o="enabled",Object.prototype.hasOwnProperty.call(Object(t),o))&&(this._enabled=e.enabled),this.debouncedRequestAuthUpdate=debounce(this.requestAuthUpdate.bind(this),2e3),this.onStorageChange=this.onStorageChange.bind(this),window.addEventListener("storage",this.onStorageChange),this.init(window,window.parent)}destroy(){window.removeEventListener("storage",this.onStorageChange)}sendFrameInit(){this.sendMessage("frameInit")}onStorageChange(e){var t;const o=null===(t=e.key)||void 0===t?void 0:t.replace("mk-auth-bridge-storage-event-","");"cookie-updated"===o?this.debouncedRequestAuthUpdate():"auth-cleared"===o&&this.sendMessage("authClearedFromOtherFrame")}sendStorageEvent(e){const t=getLocalStorage();if(t)try{t.setItem("mk-auth-bridge-storage-event-"+e,""+Date.now())}catch(o){}}requestAuthUpdate(){const e={},t={enabled:this._enabled,cookies:e};this._cookieNames.forEach(t=>{const o=getCookie(t);o?(e[t]=o,this._enabled&&setFrameCookie(t,o)):e[t]=null}),this.sendMessage("updateAuth",t),this._enabled&&setTimeout(()=>this._cookieNames.forEach(e=>removeCookie(e,window,"apple.com")),1e3)}setCookieItem(e){const{name:t,value:o}=e;this._enabled&&setFrameCookie(t,o),this.debouncedRequestAuthUpdate(),isFrameCookie(t)&&this.sendStorageEvent("cookie-updated")}clearAuth(){let e=!1;this._cookieNames.forEach(t=>{getCookie(t)&&(e=!0),this._enabled&&removeCookie(t)}),this.requestAuthUpdate(),e&&this.sendStorageEvent("auth-cleared")}}).sendFrameInit()}));
